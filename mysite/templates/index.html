{% extends "base.html" %}

{% block head %}
<script type="text/javascript">
$(function(){
    datepicker_options = {
        showButtonPanel: true,
        showOn: "both",
        buttonImage: "images/calendar.gif",
        buttonImageOnly: true
    };
    timepicker_options = datepicker_options;

    $('#start_date').datepicker(datepicker_options);
    $('#end_date').datepicker(datepicker_options);
    $('#start_time').timepicker(timepicker_options);
    $('#end_time').timepicker(timepicker_options);

    $('#submit').click(function(){
        data = $('#event-info-form').serializeArray();
        timezone = jstz.determine_timezone();
        timezone_name = timezone.name();
        data.push({'name':'timezone', 'value': timezone_name});
        console.log(data);
        data = JSON.stringify(data);
        console.log(data);
        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: '/ajax_add_event',
            data: data,
            success: function(data){
                console.log(data);
                url = data['google_url'];
                $('#result').show();
                $('#result').empty();
                $('#result').append(url);
            },
            error: function(e){
                console.log(e);
                alert('aw, crud. an error.' + e);
            },
        });
        return false;
    });
    // grab the current time/date and set it as the defaults
    now = new Date();
    in_one_hour = new Date(now.getTime() + (1000*60*60));
    time = now.getHours() + ':' + now.getMinutes();
    time_in_one_hour = in_one_hour.getHours() + ':' + in_one_hour.getMinutes();
    date = now.getMonth() + '/' + now.getDate() + '/' + now.getFullYear();
    date_in_one_hour = in_one_hour.getMonth() + '/' + in_one_hour.getDate() + '/' + in_one_hour.getFullYear();

    $('#start_date').val(date);
    $('#end_date').val(date_in_one_hour);
    $('#start_time').val(time);
    $('#end_time').val(time_in_one_hour);
});

</script>
{% endblock %}
{% block main %}

<ol>
<li>
Fill in the meeting/party/whatever deets below
</li>
<li>
We'll give you a link that people can use to automatically calendar it.
</li>
<li>
There is no step 3.
</li>
</ol>

<form id="event-info-form">
<fieldset>

<fieldset>
<label for="title">
Event title:
</label>
<input type="text" name="title" id="title" />
</fieldset>

<fieldset>
<label for="location">Location:</label>
<input type="text" name="location" id="location" />
</fieldset>

<fieldset id="start">
<label class="startend">
Start:
</label>
<fieldset class="onerow">
<div class="inline-block">
<label for="start_date">date: </label>
<input type="date" name="start_date" id="start_date"/>
</div>
<div class="inline-block">
<label for="start_date">time: </label>
<input type="time" name="start_time" id="start_time"/>
</div>
</fieldset>
</fieldset>

<fieldset id="end">
<label class="startend">
End:
</label>
<fieldset class="onerow">
<div class="inline-block">
<label for="start_date">date: </label>
<input type="date" name="end_date" id="end_date"/>
</div>
<div class="inline-block">
<label for="start_date">time: </label>
<input type="time" name="end_time" id="end_time"/>
</div>
</fieldset>
</fieldset>


<fieldset>
<label for="location">Other Info:</label>
<textarea name="info" id="info"></textarea>
</fieldset>

<fieldset id="submit">
<input type="submit" id="submit" value="Get Link &raquo;" />
</fieldset>


</fieldset>
</form>

<div id="result">
</div>

{% endblock %}

